define("modules/clean/multiaccount_login",["require","exports","tslib","jquery","modules/clean/dbmodal","modules/clean/teams/team_assume_user_personal_locked_modal","modules/clean/viewer","modules/core/browser","modules/core/controller_helpers","modules/core/exception","modules/core/i18n","modules/core/notify"],(function(e,t,o,r,n,s,a,l,i,d,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=o.__importDefault(r),s=o.__importStar(s),l=o.__importStar(l),i=o.__importStar(i);var _=(function(){function e(){}return e.$element=function(){return r.default("#db-modal-multiaccount-login-modal")},e.set_during_login_callback=function(e){return d.assert(!this._during_login_callback,"already have a during_login_callback"),this._during_login_callback=e},e.show_modal=function(e){var t,o,s=this;if(void 0===e&&(e={}),a.Viewer.get_viewer().is_team_assume_user_session)return this.show_personal_account_disabled_modal();this.$element=r.default.isFunction(this.$element)?this.$element():this.$element,d.assert(null!=this.$element&&!!this.$element.length,"MultiaccountLogin needs its @$element to be set"),d.assert(!(null!=e.on_success&&null!=e.success_href),"on_success and success_href are mutually exclusive"),null!=e.user?o=e.user:null!=e.user_id?o=a.Viewer.get_viewer().get_user_by_id(e.user_id,!0):null!=e.role&&(o=a.Viewer.get_viewer().get_user_by_role(e.role,!0)),d.assert(null!=o,"invalid user");var _=o.role;d.assert(!a.Viewer.get_viewer().is_user_signed_in(o),"called MultiaccountLogin for a user that's already signed in"),t="personal"===_?u._("Sign in to your personal Dropbox"):u._("Sign in to your %(team_name)s Dropbox").format({team_name:a.Viewer.get_viewer().team_name});var m=this.$element.find("form");return i.get_controller(m).reset(),i.get_controller(m).set_input_value("login_email",o.email),this.auth_success_callback=function(){a.Viewer.get_viewer()._sign_in_all_users();var t=function(t){return null!=t?(c.Notify.error(t),a.Viewer.get_viewer()._sign_out_user_by_id(o.id),void s.modal.hide()):null!=e.success_href?l.get_uri().toString()!==e.success_href?l.redirect(e.success_href):l.reload():(s.modal.hide(),"function"==typeof e.on_success?e.on_success():void 0)};return null!=s._during_login_callback&&null==e.success_href?s._during_login_callback(o,t):t(),!1},r.default(document).off("db:multilogin:success"),r.default(document).on("db:multilogin:success",this.auth_success_callback),this.modal=new n.DBModal({element_id:"multiaccount-login-modal"}),this.modal.show(),this.modal.set_title(t),this.$element.find('input[name="login_password"]').focus()},e.show_page_login_modal=function(e){for(var t=a.Viewer.get_viewer(),o=null,r=0,n=Array.from(t.get_users(!0));r<n.length;r++){var s=n[r];if(!t.is_user_signed_in(s)){o=s;break}}if(o){var l={user:o};return"string"==typeof e?l.success_href=e:"function"==typeof e&&(l.on_success=e),this.show_modal(l),!1}},e.show_personal_account_disabled_modal=function(){var e=a.Viewer.get_viewer();return s.AssumePersonalLockedModal.show({displayName:e.display_name,teamName:e.team_name}),!1},e})();t.default=_})),define("modules/clean/sharing/async_shared_content_link_sync_utils",["require","exports","tslib","modules/core/browser","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/web_timing_logger"],(function(e,t,o,r,n,s){"use strict";function a(){var e=window;return window.__REGISTER_SYNC_VARS_PRELOAD?new Promise((function(t,o){e.__REGISTER_SYNC_VARS_PRELOAD((function(e){t(e?JSON.parse(e):void 0)}),o)})):Promise.resolve(void 0)}Object.defineProperty(t,"__esModule",{value:!0}),r=o.__importStar(r),s=o.__importStar(s),t.asyncSharedContentLinkSyncUtilsInitialize=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,l;return o.__generator(this,(function(o){switch(o.label){case 0:return s.log_js_modules_application_code_start(),[4,a()];case 1:return(t=o.sent())&&t.redirect&&r.redirect(t.redirect_url),l=t||e.syncVars,n.showSharedContentSyncModal(e.activeUserId,l,e.metadata),[2]}}))}))}})),define("modules/clean/sharing/role_selector_modal",["require","exports","tslib","jquery","modules/clean/dbmodal","modules/clean/multiaccount_login","modules/clean/viewer"],(function(e,t,o,r,n,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=o.__importDefault(r),s=o.__importDefault(s);var l=(function(e){function t(t){var o=e.call(this,{element_id:"select-role-modal-sync"})||this;return o.onSelectRole=t,o}return o.__extends(t,e),t.prototype.on_show=function(){var e=this;return r.default(".role-options li").click((function(t){var o=r.default(t.target).closest("li").data("role");return e.hide(),a.Viewer.get_viewer().is_role_signed_in(o)?e.onSelectRole(o):s.default.show_modal({role:o,on_success:function(){return e.onSelectRole(o)}})}))},t})(n.DBModal);t.RoleSelectorModal=l})),define("modules/clean/sharing/shared_content_link_sync_modal",["require","exports","tslib","classnames","react","spectrum/button","spectrum-sharing/components/sharing_modal_banner","modules/clean/analytics","modules/clean/em_string","modules/clean/filepath","modules/clean/growth/experiments/overquota_sharing_helper","modules/clean/history","modules/clean/react/async/loadable","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react_format","modules/clean/sharing/constants","modules/clean/sharing/views/hover_close_button","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/payments","modules/core/browser","modules/core/i18n","modules/core/uri","modules/clean/react/overquota_modal_helpers"],(function(e,t,o,r,n,s,a,l,i,d,u,c,_,m,p,f,h,g,v,y,b,w,S,N,O){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=o.__importDefault(r),n=o.__importDefault(n),d=o.__importStar(d),u=o.__importStar(u),c=o.__importDefault(c),g=o.__importDefault(g),y=o.__importStar(y),b=o.__importStar(b),w=o.__importStar(w),S=o.__importStar(S);var E=S.i18n_default_project("sharing")._,T=(function(t){function S(e){var o=t.call(this,e)||this;return o.ASK="ask",o.ASKING="asking",o._closeSyncModal=function(){var e=o.props.outOfQuotaQP;e&&(l.NQOQLogger.logCloseModal(e,{modal_type:"billboard"}),o.logOutOfQuotaClose()),c.default.remove_query_param("sm"),o.refs.modal.close()},o._renderTopPanelIcon=function(){return o.props.targetFile?n.default.createElement(p.Sprite,{alt:"",group:"web",name:o.props.targetFile.icon}):n.default.createElement(p.Sprite,{alt:"",group:"web",name:"folder_user_32"})},o._renderTopPanelTitle=function(){return o.props.targetFile?i.Emstring.em_snippet(d.filename(o.props.targetFile.fq_path),15):i.Emstring.em_snippet(o.props.folderName,15)},o._renderTopPanelSubtitle=function(){return o.props.targetFile?o.props.ownerName?E("Owned by %(name)s").format({name:o.props.ownerName}):E("Not currently owned"):o.props.folderSize},o._renderAccessTextForOutOfQuota=function(){return n.default.createElement("div",{className:"content-link-sync-modal__access-text"},E("Not enough space"))},o._renderAccessTextForSync=function(){return"can_view"===o.props.accessLevel?f.reactFormat(E("%(name)s (%(email)s) <br /> invited you to view this folder"),{name:o.props.senderName,email:o.props.senderEmail,br:n.default.createElement("br",null)}):f.reactFormat(E("%(name)s (%(email)s) <br /> invited you to edit this folder"),{name:o.props.senderName,email:o.props.senderEmail,br:n.default.createElement("br",null)})},o._renderAccessText=function(){return o.props.outOfQuotaQP?o._renderAccessTextForOutOfQuota():n.default.createElement("div",{className:"content-link-sync-modal__access-text"},o.props.senderName?o._renderAccessTextForSync():"can_view"===o.props.accessLevel?E("You have access to view this folder"):E("You have access to edit this folder"))},o._renderSharedFolderInfo=function(){return n.default.createElement("div",{className:"content-link-sync-modal__shared-folder-info"},n.default.createElement("div",{className:"content-link-sync-modal__shared-folder-text"},(o.props.targetFile?o.props.targetFile.is_dir:void 0)?E("This folder is part of a shared folder:"):E("This file is part of a shared folder:")),n.default.createElement("div",null,n.default.createElement(p.Sprite,{alt:"",group:"web",name:"folder_user_32"})),n.default.createElement("p",{className:"u-font-meta"},o.props.folderName,n.default.createElement("br",null),o.props.folderSize))},o._renderTipBody=function(e){return o.props.outOfQuotaQP?"V1"===o.props.expSubgrowthProShareUpsellModalFileAttr?E("To add this folder, you’ll need more space in your Dropbox."):o.props.usageRemaining?E("To add this folder, you’ll need %(needed)s of space in your Dropbox. You currently have %(remaining)s of space left.").format({remaining:o.props.usageRemaining,needed:o.props.usageNeeded}):o.props.usageNeeded?E("To add this folder, you’ll need %(needed)s of space in your Dropbox. You currently have no space left.").format({needed:o.props.usageNeeded}):E("To add this folder, you’ll need %(needed)s of space in your Dropbox. You currently have not enough space left.").format({needed:o.props.folderSize}):E("Add it to Dropbox to start working together.",{comment:'"it" refers to the folder the user is trying to sync'})},o._renderPreviewLink=function(){return"can_view"===o.props.accessLevel?n.default.createElement("div",null,n.default.createElement("span",{className:"content-link-sync-modal__or"},E("Or")),n.default.createElement("button",{className:"content-link-sync-modal__not-now-label button-as-link",onClick:o.onPreviewButtonClicked},!o.props.targetFile||o.props.targetFile.is_dir?E("preview this folder"):E("preview this file"))):null},o.logOutOfQuotaClose=function(){var e=y.start_time(),t=(new Date).getTime();l.ShareTibEventLogger.log(o.props.activeUserId,"OUT_OF_QUOTA_MODAL_CLOSE",h.SHARE_ACTION_ORIGIN_TYPE.SYNC_MODAL,{timing:t-e,ns_id:o.props.syncNSId})},o.onDismiss=function(){var e=o.props.outOfQuotaQP;e&&(l.NQOQLogger.logCloseModal(e,{modal_type:"billboard"}),o.logOutOfQuotaClose())},o._handleDismissText=function(){m.Modal.close(),o.onDismiss()},o.requestCallback=function(){var e=o.props.outOfQuotaQP,t=h.SHARE_ACTION_ORIGIN_TYPE.SYNC_MODAL;if(e){l.ShareTibEventLogger.log(o.props.activeUserId,"OUT_OF_QUOTA_MODAL_UPGRADE",t,{ns_id:o.props.syncNSId,usage_remaining:o.props.usageRemaining,usage_needed:o.props.usageNeeded});var r="wb_nq_shm_share_w"===e||"wb_nq_shm_share_ro"===e?b.LOW_SPACE_URL:b.OUT_OF_SPACE_URL,n=new N.URI({path:r}).updateQuery({oqa:e});w.redirect(n.toString())}else o.props.targetFile&&l.ShareTibEventLogger.log(o.props.activeUserId,"UNMOUNTED_SEARCH_SYNC",t,{ns_id:o.props.syncNSId}),o.props.onMountSharedFolder(),o._closeSyncModal()},o.onSyncButtonClicked=function(){o.setState({state:o.ASKING});var e=o.props.outOfQuotaQP;e&&l.NQOQLogger.logAcceptModal(e,{modal_type:"billboard",cta_text:"upgrade to add folder"}),o.requestCallback()},o.onPreviewButtonClicked=function(){var e=o.props.outOfQuotaQP;if(e&&l.NQOQLogger.logPreviewLink(e,{modal_type:"billboard"}),o.props.previewCallback){var t=h.SHARE_ACTION_ORIGIN_TYPE.SYNC_MODAL;l.ShareTibEventLogger.log(o.props.activeUserId,"UNMOUNTED_SEARCH_PREVIEW",t,{ns_id:o.props.syncNSId}),o.props.previewCallback()}else{var r=o.props.previewUrl?N.URI.parse(o.props.previewUrl):w.get_uri().removeQuery("sm");r.updateQuery({from_sync_modal:!0}),w.redirect(r)}},o.state={state:o.ASK,showX:!0},o}return o.__extends(S,t),S.showInstance=function(t){m.Modal.showInstance(t);var r=t.props.outOfQuotaQP;if(r){l.NQOQLogger.logViewModal(r,{modal_type:"billboard"});var n=t.props,s=n.expSubgrowthProShareUpsellModalFileAttr,a=n.expSubgrowthProShareModalIllustration,i=n.expSubgrowthProShmCtaCopy;s&&"OFF"!==s&&new Promise((function(t,o){e(["modules/clean/stormcrow/stormcrow_exposure_logger"],t,o)})).then(o.__importStar).then((function(e){var t=e.StormcrowExposureLogger,r=null;s&&"OFF"!==s&&(r={subgrowth_pro_share_upsell_modal_file_attr:s});var n=null;s&&"V2"===s&&a&&"OFF"!==a&&(n={subgrowth_pro_share_modal_illustration:a});var l=null;i&&"OFF"!==i&&(l={subgrowth_pro_shm_cta_copy:i}),(new t).logExposuresOnce(o.__assign({},r,n,l))}))}},S.prototype.componentWillMount=function(){var e=y.start_time(),t=(new Date).getTime();this.user=v.Viewer.get_viewer().get_user_by_id(this.props.activeUserId);var r=h.SHARE_ACTION_ORIGIN_TYPE.SYNC_MODAL;if(this.props.outOfQuotaQP)l.ShareTibEventLogger.log(this.props.activeUserId,"OUT_OF_QUOTA_MODAL_RENDER",r,{timing:t-e,ns_id:this.props.syncNSId});else{var n=this.props.targetFile?"UNMOUNTED_SEARCH_MODAL_RENDER":"SYNC_MODAL_RENDER";l.ShareTibEventLogger.log(this.props.activeUserId,n,r,{timing:t-e,ns_id:this.props.syncNSId})}var s=this.props.expSubgrowthProShmCtaCopy;s&&"OFF"!==s&&this.setState(o.__assign({},this.state,u.getModalConfigSubgrowthProShmCtaCopy(s)))},S.prototype._renderDismissButton=function(){return this.state.secondaryCtaText&&this.state.secondaryCtaText.length?n.default.createElement("button",{className:"content-link-sync-modal__not-now-label button-as-link",onClick:this._handleDismissText},this.state.secondaryCtaText):null},S.prototype.render=function(){var e,t=r.default({"content-link-sync-modal":!0});this.user.is_cdm_member&&(e=d.filename(this.user.cdm_tmf_path));var o=this.renderContent(e),s=this.props,a=s.expSubgrowthProShareUpsellModalFileAttr,l=s.outOfQuotaQP;return a&&l&&"V2"===a?this.renderOverquotaModal(l):n.default.createElement(m.Modal,{autoClose:!1,buttonComponent:this.renderButtons(e),className:t,clickOutToClose:!1,ref:"modal",showX:!1,title:"",onDismiss:this.onDismiss},o)},S.prototype.renderOverquotaModal=function(t){var r=_.Loadable({loader:function(){return new Promise((function(t,o){e(["modules/clean/react/overquota_modal"],t,o)})).then(o.__importStar).then((function(e){return e.OverquotaModal}))}}),s=O.constructImageObject(this.props.expSubgrowthProShareModalIllustration),a=this.state,l=a.buttonText,i=a.buttonTextUntranslated,d=a.secondaryCtaText,u=a.showX;return n.default.createElement(r,{headline:E("Not enough space"),tagline:E("To add this folder, you’ll need more space in your Dropbox."),oqa:t,imageObject:s,ctaText:l,ctaTextUntranslated:i,dismissText:d,showX:u})},S.prototype.renderContent=function(e){var t=this.state.showX;return n.default.createElement("div",{className:"content-link-sync-modal__content"},n.default.createElement("div",{className:"content-link-sync-modal__top-panel u-pad-s"},n.default.createElement("div",{className:"content-link-sync-modal__icon u-pad-top-xs"},this._renderTopPanelIcon()),n.default.createElement("div",{className:"content-link-sync-modal__name-size u-l-ib u-pad-left-xs u-pad-top-xs o-flag__flex"},n.default.createElement("h3",{className:"u-font-strong"},this._renderTopPanelTitle()),n.default.createElement("h4",{className:"u-trim-margin u-font-meta"},this._renderTopPanelSubtitle())),t&&n.default.createElement("div",{className:"content-link-sync-modal__close u-pad-xs o-flag__fix"},n.default.createElement(g.default,{onClick:this._closeSyncModal}))),this.props.senderIsOffTeam&&!this.props.outOfQuotaQP&&!this.props.targetFile&&n.default.createElement(a.SharingModalBanner,{borderHidden:!0,className:"content-link-sync-modal__off-team-warning",message:E("This person is outside your Dropbox team."),type:"warn"}),n.default.createElement("div",{className:"content-link-sync-modal__tip-panel u-pad-top-m u-pad-horizontal-m"},this.props.targetFile?this._renderSharedFolderInfo():this._renderAccessText(),n.default.createElement("div",{className:"content-link-sync-modal__tip-body"},this._renderTipBody(e))))},S.prototype.renderButtons=function(e){var t=this.props.outOfQuotaQP?E("Upgrade to add folder"):this.props.targetFile?this.user.is_cdm_member?this.getButtonTextForCDM(e):E("Add folder to Dropbox"):this.user.is_cdm_member?this.getButtonTextForCDM(e):E("Add to Dropbox");return this.state.buttonText&&(t=this.state.buttonText),n.default.createElement("div",{className:"content-link-sync-modal__buttons u-pad-m"},n.default.createElement(s.Button,{className:"content-link-sync-modal__add-to-dropbox-button",disabled:this.state.state===this.ASKING,onClick:this.onSyncButtonClicked,variant:"primary"},t),"can_view"===this.props.accessLevel?this._renderPreviewLink():void 0,this._renderDismissButton())},S.prototype.getButtonTextForCDM=function(e){return this.props.targetFile?e.length>9?E("Add folder to my member folder"):f.reactFormat(E("Add folder to <strong>%(cdm_tmf_name)s</strong> folder"),{cdm_tmf_name:e,strong:n.default.createElement("strong",{style:{fontWeight:800}})}):e.length>17?E("Add to my member folder"):f.reactFormat(E("Add to <strong>%(cdm_tmf_name)s</strong> folder"),{cdm_tmf_name:e,strong:n.default.createElement("strong",{style:{fontWeight:800}})})},S.prototype.componentDidMount=function(){y.mark_time_to_interactive()},S.displayName="SharedContentLinkSyncModal",S})(n.default.Component);t.SharedContentLinkSyncModal=T})),define("modules/clean/sharing/shared_content_link_sync_utils",["require","exports","tslib","react","modules/clean/sharing/shared_content_link_sync_modal","modules/core/browser","modules/clean/web_timing_logger"],(function(e,t,o,r,n,s,a){"use strict";function l(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,o){e(["modules/clean/sharing/shared_content_link_mount_folder"],t,o)})).then(o.__importStar)];case 1:return[2,t.sent().mountSharedFolder]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),r=o.__importDefault(r),s=o.__importStar(s),t.showSharedContentSyncModal=function(e,t,i,d){if(void 0===d&&(d=null),t&&t.sync_ns_id){var u=t.sync_owner_name||t.ownerName;a.waitForTTI().then(l),n.SharedContentLinkSyncModal.showInstance(r.default.createElement(n.SharedContentLinkSyncModal,{activeUserId:e,accessLevel:t.access_level,expSubgrowthProShareUpsellModalFileAttr:t.exp_subgrowth_pro_share_upsell_modal_file_attr,expSubgrowthProShareModalIllustration:t.exp_subgrowth_pro_share_modal_illustration,expSubgrowthProShmCtaCopy:t.exp_subgrowth_pro_shm_cta_copy,folderName:t.sync_folder_name,folderSize:t.sync_folder_size.toString(),outOfQuotaQP:t.sync_out_of_quota_qp,usageRemaining:t.sync_usage_remaining,usageNeeded:t.sync_usage_needed,senderName:t.sync_sender_name,senderEmail:t.sync_sender_email,senderIsOffTeam:t.sync_sender_is_off_team,ownerName:u,targetFile:d,previewCallback:null!=d?s.redirect.bind(s,t.sync_preview_url):void 0,previewUrl:t.sync_preview_url,onMountSharedFolder:function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return[4,l()];case 1:return e.sent()(t.sync_ns_id,t.sync_role,"SYNC_MODAL",!1,!0,d,t.exp_sharing_team_success_remove_redirect_on_mount,i),[2]}}))}))},syncNSId:t.sync_ns_id,ownerProfilePhotoUrl:t.ownerProfilePhotoUrl}))}}})),define("modules/clean/teams/team_assume_user_personal_locked_modal",["require","exports","tslib","react","react-dom-factories","prop-types","modules/clean/react/modal","modules/core/i18n","modules/clean/react/css"],(function(e,t,o,r,n,s,a,l,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=o.__importDefault(r),n=o.__importStar(n),s=o.__importStar(s);var d=r.default.createElement,u=(function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._close=function(e){return e.preventDefault(),a.Modal.close()},t._getModalProps=function(){return{title:l._("Personal account not accessible"),acceptButtonText:l._("Close"),dismissButtonText:null,onAccept:t._close}},t}return o.__extends(r,e),r.show=function(e){return a.Modal.showInstance(d(t.AssumePersonalLockedModal,e))},r.prototype.render=function(){return d(a.Modal,this._getModalProps(),n.div({className:"team-assume-user-modal"},l._("%(display_name)s’s personal account isn’t managed by the %(team_name)s team, so its contents aren’t accessible to admins.").format({display_name:this.props.displayName,team_name:this.props.teamName})))},r.displayName="AssumePersonalLockedModal",r.propTypes={displayName:s.string,teamName:s.string},r})(r.default.Component);t.AssumePersonalLockedModal=i.requireCssWithComponent(u,["/static/css/team_assume_user_modal-vflqfLhJ1.css"])}));
//# sourceMappingURL=pkg-sharing-sync.min.js-vflmD6--c.map