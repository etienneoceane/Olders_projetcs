define(["require","exports","tslib","modules/clean/browse_interface","modules/clean/multiaccount_login","modules/clean/sharing/api/client","modules/clean/api_v2/user_client","modules/clean/sharing/role_selector_modal","modules/clean/sharing/ui_notifications_util","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/clean/flux/dispatcher","modules/clean/sharing/share_page/action_types","modules/clean/sharing/shared_content_link_handle_folder_mount_done"],(function(e,o,r,i,n,t,a,s,l,_,d,u,c,m,p,f){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),i=r.__importStar(i),n=r.__importDefault(n),d=r.__importStar(d),c=r.__importStar(c),o.mountSharedFolder=function e(o,r,h,g,b,v,y,w){void 0===b&&(b=!1),void 0===v&&(v=null),void 0===y&&(y=!1);var S,D=c.i18n_default_project("sharing")._,E=_.Viewer.get_viewer();if(r)E.is_role_signed_in(r)||n.default.show_modal({role:r,on_success:function(){e(o,r,h,g,!1,null,y,w)}});else if(E.is_paired){new s.RoleSelectorModal((function(r){e(o,r,h="PREVIEW_PAGE",g,!1,null,y,w)})).show()}if(r){var x=E.get_uid_by_role(r);u.assert(!!x,"selected role should have corresponding uid"),S=x||-1}else u.assert(!E.is_paired,"role can not be unspecified for paired viewer"),S=E.get_user_ids()[0];var A=D("Adding to your Dropbox...");E.is_paired&&(A=E.get_user_by_id(S).is_team?(A=D("Adding to your %(team_name)s Dropbox...")).format({team_name:E.team_name}):D("Adding to your personal Dropbox...")),l.sharingNotificationSuccess(A);var q=new t.FolderShareApiClient({userId:S,client:new a.UserApiV2Client});m.Dispatcher.dispatch({type:p.SharePageActionTypes.MOUNT_FOLDER_REQUEST,metadata:w,user:E.get_user_by_id(S)}),q.mount({contentId:o}).then((function(e){y&&!g?f.handleFolderMountDone(E.get_user_by_id(S),e,w.is_team_folder,w.can_mount||!1,w.folder_size,w.permissions):(function(e){if(e){var o=e;v&&(o+=v.ns_path);var r=E.get_user_by_id(S),n=i.browse_uri_for_fq_path(r,o),t=b?"1":"0";n.updateQuery({from_scl_sync_modal:t}),d.redirect(n.toString())}})(e.path_lower)})).catch((function(e){e&&e.error&&"insufficient_quota"===e.error[".tag"]?l.sharingNotificationError(D("Canâ€™t add folder. Your Dropbox account is full.")):l.sharingNotificationError(D("We were unable to complete your request."))}))}}));
//# sourceMappingURL=shared_content_link_mount_folder.min.js-vflx_d9aU.map