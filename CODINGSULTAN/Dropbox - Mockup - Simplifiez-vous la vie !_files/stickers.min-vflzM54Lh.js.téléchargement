define(["require","exports","tslib","tslib","comments2/components/comment_editor/core/class_decorators","comments2/components/comment_editor/layers/scaffold","comments2/components/comment_editor/core/types","draft-js"],(function(t,e,r,o,n,a,i,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o=r.__importStar(o);var s=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.initStyle=function(t){var e=t.innerProps.evt,r=this.splitStickers(e.metadata).stickers;if(r.length){var o=r[0],n=c.ContentState.createFromText("").createEntity("sticker","IMMUTABLE",o),a=n.getLastCreatedEntityKey(),i=c.AtomicBlockUtils.insertAtomicBlock(c.EditorState.createWithContent(n),a,"*").getCurrentContent().getBlockMap().skip(1).first(),s=c.ContentState.createFromBlockArray([i]);return c.EditorState.createWithContent(s)}},e.prototype.postStyles=function(t){var e=t.innerProps,o=e.evt,n=e.value,a=this.getStickerMetadata(c.convertToRaw(o.getCurrentContent())),i=this.splitStickers(n.metadata).other;return r.__assign({},n,{metadata:i.concat(a)})},e.prototype.getStickerMetadata=function(t){return t.blocks.reduce((function(e,o){var n=e.metadata,a=e.pos,i=o.entityRanges;return{metadata:n.concat(i.filter((function(e){return"sticker"===t.entityMap[e.key].type})).map((function(e){var o=t.entityMap[e.key].data;return r.__assign({type:"sticker"},o.metadata[0])}))),pos:a+o.text.length}}),{metadata:[],pos:0}).metadata},e.prototype.splitStickers=function(t){return t.reduce((function(t,e){return"sticker"===e.type?{stickers:t.stickers.concat([e]),other:t.other}:{stickers:t.stickers,other:t.other.concat([e])}}),{stickers:[],other:[]})},e})(i.BaseLayer);e.StickerLayer=s,o.__decorate([n.plug(a.into.draft.on.populateWithComment.update.editorState)],s.prototype,"initStyle",null),o.__decorate([n.plug(a.into.comment.on.post.update.content)],s.prototype,"postStyles",null)}));
//# sourceMappingURL=stickers.min.js-vflCbzeXa.map